<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>My Orders - Two Dots</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Poppins', sans-serif;
      background: #f8f8f8;
      color: #333;
      line-height: 1.6;
    }
    
    .header {
      position: sticky;
      top: 0;
      background: white;
      z-index: 999;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 16px;
      box-shadow: 0 3px 15px rgba(0,0,0,0.1);
    }
    
    .back-btn {
      font-size: 25px;
      cursor: pointer;
      color: #00b3a6;
    }
    
    .page-title {
      font-size: 20px;
      font-weight: 700;
      color: #00b3a6;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px 16px;
    }
    
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #666;
    }
    
    .empty-state i {
      font-size: 60px;
      color: #ddd;
      margin-bottom: 20px;
    }
    
    .empty-state h2 {
      font-size: 22px;
      margin-bottom: 10px;
      font-weight: 600;
    }
    
    .empty-state p {
      margin-bottom: 25px;
      color: #888;
    }
    
    .shop-now-btn {
      display: inline-block;
      background: #00b3a6;
      color: white;
      padding: 12px 30px;
      border-radius: 10px;
      text-decoration: none;
      font-weight: 600;
      font-size: 16px;
      transition: all 0.3s;
    }
    
    .shop-now-btn:hover {
      background: #009c8f;
      transform: translateY(-2px);
    }
    
    .order-card {
      background: white;
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.05);
      transition: transform 0.3s;
    }
    
    .order-card:hover {
      transform: translateY(-2px);
    }
    
    .order-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px solid #eee;
    }
    
    .order-id {
      font-weight: 600;
      font-size: 16px;
      color: #333;
    }
    
    .order-date {
      color: #666;
      font-size: 14px;
    }
    
    .order-status {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }
    
    .status-confirmed {
      background: #e6f7f6;
      color: #00b3a6;
    }
    
    .status-shipped {
      background: #fff3e0;
      color: #ff9800;
    }
    
    .status-delivered {
      background: #e8f5e9;
      color: #4caf50;
    }
    
    .status-cancelled {
      background: #ffebee;
      color: #f44336;
    }
    
    .order-item {
      display: flex;
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px solid #f5f5f5;
    }
    
    .order-item:last-child {
      margin-bottom: 0;
      padding-bottom: 0;
      border-bottom: none;
    }
    
    .item-image {
      width: 80px;
      height: 80px;
      border-radius: 10px;
      overflow: hidden;
      margin-right: 15px;
      background: #f5f5f5;
    }
    
    .item-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .item-details {
      flex: 1;
    }
    
    .item-name {
      font-weight: 600;
      margin-bottom: 5px;
    }
    
    .item-size, .item-qty {
      color: #666;
      font-size: 14px;
      margin-bottom: 3px;
    }
    
    .item-price {
      font-weight: 600;
      color: #00b3a6;
    }
    
    .order-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #eee;
    }
    
    .order-total {
      font-weight: 700;
      font-size: 18px;
    }
    
    .order-actions {
      display: flex;
      gap: 10px;
    }
    
    .btn {
      padding: 8px 16px;
      border-radius: 8px;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      border: none;
      transition: all 0.3s;
    }
    
    .btn-primary {
      background: #00b3a6;
      color: white;
    }
    
    .btn-primary:hover {
      background: #009c8f;
    }
    
    .btn-secondary {
      background: #f5f5f5;
      color: #333;
    }
    
    .btn-secondary:hover {
      background: #e5e5e5;
    }
    
    .btn-danger {
      background: #ffebee;
      color: #f44336;
    }
    
    .btn-danger:hover {
      background: #ffcdd2;
    }
    
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .cancel-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    
    .cancel-modal-content {
      background: white;
      border-radius: 16px;
      width: 100%;
      max-width: 400px;
      padding: 24px;
      text-align: center;
      animation: modalSlideIn 0.3s ease-out;
    }
    
    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .cancel-modal h2 {
      margin-bottom: 15px;
      color: #333;
    }
    
    .cancel-modal p {
      margin-bottom: 20px;
      color: #666;
      line-height: 1.5;
    }
    
    .cancel-modal-actions {
      display: flex;
      gap: 10px;
      justify-content: center;
    }
    
    .cancel-reason {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      margin-bottom: 20px;
      font-family: 'Poppins', sans-serif;
      resize: vertical;
      min-height: 80px;
    }
    
    .cancel-reason:focus {
      outline: none;
      border-color: #00b3a6;
    }
    
    @media (max-width: 480px) {
      .order-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }
      
      .order-footer {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
      }
      
      .order-actions {
        width: 100%;
        justify-content: space-between;
      }
      
      .cancel-modal-actions {
        flex-direction: column;
      }
      
      .cancel-modal-actions .btn {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <!-- HEADER -->
  <div class="header">
    <div class="back-btn" onclick="history.back()">
      <i class="fas fa-arrow-left"></i>
    </div>
    <div class="page-title">My Orders</div>
    <div style="width: 25px;"></div>
  </div>

  <div class="container" id="ordersContainer">
    <!-- Orders will be loaded here -->
  </div>

  <!-- Cancel Order Modal -->
  <div class="cancel-modal" id="cancelModal">
    <div class="cancel-modal-content">
      <h2>Cancel Order</h2>
      <p>Are you sure you want to cancel this order? This action cannot be undone.</p>
      <textarea class="cancel-reason" id="cancelReason" placeholder="Reason for cancellation (optional)"></textarea>
      <div class="cancel-modal-actions">
        <button class="btn btn-secondary" id="cancelNo">Keep Order</button>
        <button class="btn btn-danger" id="cancelYes">Cancel Order</button>
      </div>
    </div>
  </div>

  <script>
    let currentCancelOrderId = null;

    // Load orders from localStorage
    document.addEventListener('DOMContentLoaded', function() {
      loadOrders();
    });

    function loadOrders() {
      try {
        const orders = JSON.parse(localStorage.getItem('twoDotsOrders') || '[]');
        displayOrders(orders);
      } catch (error) {
        console.error('Error loading orders:', error);
        showErrorState();
      }
    }

    function displayOrders(orders) {
      const container = document.getElementById('ordersContainer');
      
      if (!orders || orders.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-shopping-bag"></i>
            <h2>No Orders Yet</h2>
            <p>You haven't placed any orders with us yet.</p>
            <a href="index.html" class="shop-now-btn">Start Shopping</a>
          </div>
        `;
        return;
      }

      // Sort orders by date (newest first)
      orders.sort((a, b) => new Date(b.date) - new Date(a.date));

      container.innerHTML = orders.map(order => {
        const orderDate = new Date(order.date).toLocaleDateString('en-US', {
          year: 'numeric',
          month: 'short',
          day: 'numeric'
        });

        const statusClass = `status-${order.status}`;
        const statusText = order.status.charAt(0).toUpperCase() + order.status.slice(1);

        // Check if order can be cancelled (only confirmed orders)
        const canCancel = order.status === 'confirmed';

        return `
          <div class="order-card" data-order-id="${order.id}">
            <div class="order-header">
              <div>
                <div class="order-id">${order.id}</div>
                <div class="order-date">Ordered on ${orderDate}</div>
              </div>
              <div class="order-status ${statusClass}">${statusText}</div>
            </div>
            
            ${order.items.map(item => `
              <div class="order-item">
                <div class="item-image">
                  <img src="${item.image}" alt="${item.name}" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iODAiIHZpZXdCb3g9IjAgMCA4MCA4MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjgwIiBoZWlnaHQ9IjgwIiBmaWxsPSIjRjVGNUY1Ii8+CjxwYXRoIGQ9Ik00MCA0MEM0Mi43NjE0IDQwIDQ1IDM3Ljc2MTQgNDUgMzVDNDUgMzIuMjM4NiA0Mi43NjE0IDMwIDQwIDMwQzM3LjIzODYgMzAgMzUgMzIuMjM4NiAzNSAzNUMzNSAzNy43NjE0IDM3LjIzODYgNDAgNDAgNDBaIiBmaWxsPSIjQ0VDRUNFIi8+CjxwYXRoIGQ9Ik0zNSA1MEg0NVY1NUgzNVY1MFoiIGZpbGw9IiNDRUNFQ0UiLz4KPC9zdmc+'">
                </div>
                <div class="item-details">
                  <div class="item-name">${item.name}</div>
                  <div class="item-size">Size: ${item.size}</div>
                  <div class="item-qty">Quantity: ${item.quantity}</div>
                  <div class="item-price">₹${item.price}</div>
                </div>
              </div>
            `).join('')}
            
            <div class="order-footer">
              <div class="order-total">Total: ₹${order.total}</div>
              <div class="order-actions">
                ${canCancel ? `
                  <button class="btn btn-danger" onclick="openCancelModal('${order.id}')">
                    <i class="fas fa-times"></i> Cancel Order
                  </button>
                ` : ''}
                <button class="btn btn-secondary" onclick="viewOrderDetails('${order.id}')">
                  <i class="fas fa-eye"></i> View Details
                </button>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    function showErrorState() {
      document.getElementById('ordersContainer').innerHTML = `
        <div class="empty-state">
          <i class="fas fa-exclamation-circle"></i>
          <h2>Unable to Load Orders</h2>
          <p>There was a problem loading your order history.</p>
          <button class="shop-now-btn" onclick="location.reload()">Try Again</button>
        </div>
      `;
    }

    function openCancelModal(orderId) {
      currentCancelOrderId = orderId;
      document.getElementById('cancelModal').style.display = 'flex';
      document.getElementById('cancelReason').value = '';
    }

    function closeCancelModal() {
      document.getElementById('cancelModal').style.display = 'none';
      currentCancelOrderId = null;
    }

    function cancelOrder() {
      if (!currentCancelOrderId) return;

      const reason = document.getElementById('cancelReason').value.trim();
      
      // Update order status in localStorage
      const orders = JSON.parse(localStorage.getItem('twoDotsOrders') || '[]');
      const orderIndex = orders.findIndex(order => order.id === currentCancelOrderId);
      
      if (orderIndex !== -1) {
        orders[orderIndex].status = 'cancelled';
        if (reason) {
          orders[orderIndex].cancellationReason = reason;
        }
        localStorage.setItem('twoDotsOrders', JSON.stringify(orders));
        
        // Update UI
        const orderCard = document.querySelector(`[data-order-id="${currentCancelOrderId}"]`);
        if (orderCard) {
          const statusElement = orderCard.querySelector('.order-status');
          statusElement.textContent = 'Cancelled';
          statusElement.className = 'order-status status-cancelled';
          
          // Remove cancel button
          const cancelBtn = orderCard.querySelector('.btn-danger');
          if (cancelBtn) cancelBtn.remove();
        }
        
        closeCancelModal();
        alert('Order has been cancelled successfully.');
      } else {
        alert('Order not found. Please refresh the page.');
      }
    }

    function viewOrderDetails(orderId) {
      // For now, show alert. Can be expanded to show detailed modal
      const orders = JSON.parse(localStorage.getItem('twoDotsOrders') || '[]');
      const order = orders.find(o => o.id === orderId);
      
      if (order) {
        const details = `
Order ID: ${order.id}
Date: ${new Date(order.date).toLocaleDateString()}
Status: ${order.status}
Payment: ${order.paymentMethod === 'cod' ? 'Cash on Delivery' : 'Online Payment'}
Total: ₹${order.total}

Shipping Address:
${order.userDetails.name}
${order.userDetails.address.flat}, ${order.userDetails.address.area}
${order.userDetails.address.city}, ${order.userDetails.address.state} - ${order.userDetails.address.pincode}
Phone: ${order.userDetails.phone}
        `;
        alert(details);
      }
    }

    // Event listeners
    document.getElementById('cancelNo').addEventListener('click', closeCancelModal);
    document.getElementById('cancelYes').addEventListener('click', cancelOrder);

    // Close modal when clicking outside
    document.getElementById('cancelModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeCancelModal();
      }
    });

    // Close modal with Escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        closeCancelModal();
      }
    });
  </script>
</body>
</html>